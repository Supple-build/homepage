---
import { Picture } from 'astro:assets';
import {
	getDataPageRecord,
	type PageRecordProps,
} from 'src/utilities/api/pageRecord';
import Layout from '../../layouts/Layout.astro';
import getSanityImage from 'src/utilities/api/sanity/getSanityImage';

export async function getStaticPaths() {
	const data = await getDataPageRecord();

	return Array.isArray(data)
		? data
				.map((page) => ({
					params: {
						slug: undefined,
						record: page.slug,
					},
					props: {
						pageData: page,
					},
				}))
				.flat(Infinity)
		: [
				{
					params: {
						slug: undefined,
						record: data.slug,
					},
					props: {
						pageData: data,
					},
				},
		  ];
}

interface Props {
	pageData: PageRecordProps;
}

const { pageData } = Astro.props;
console.log('pageData', pageData);
---

<Layout metaData={pageData.metaData} type={pageData.type}>
	<Picture
		class="e-picture"
		src={getSanityImage(pageData.song.albumArt).width(640).height(640).url()}
		formats={['avif', 'webp']}
		densities={[1.5, 2]}
		width={320}
		height={320}
		alt=""
	/>
	<h1>{pageData.song.artist} - {pageData.song.title}</h1>
	<dl>
		<dt>Release date:</dt>
		<dd>{pageData.song.releaseDate}</dd>
	</dl>
</Layout>
